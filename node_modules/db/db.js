var fs = require('fs');

var readData = function(cb){
  fs.readFile(__dirname+'/database.csv', function (err, data) {    
    if(err) throw err;    
    cb(data);
  });
};

var writeData = function(data){
  fs.writeFile(__dirname+'/database.csv', data, function(err){    
    if(err) throw err;
  });  
};

exports.get = function(name, cb){
  readData(function(data){
    var lines = (''+data).split('\n'), v;
    for(var i = 0; i < lines.length; i++){
      var line = lines[i].split(';');
      var n = line[0];
      v = line[1];
      if(name == n) break;      
    }
    console.log('Get('+name+'): '+v);
    cb(v || '');
  });  
};

exports.set = function(name, val){
  readData(function(data){
    var lines = (''+data).split('\n'), i;
    for(i = 0; i < lines.length; i++){
      var line = lines[i].split(';');
      var n = line[0];
      var v = line[1];
      if(name == n) break;
    }  
    lines[i] = name + ';' + val;
    writeData(lines.join('\n')); 
  });
};