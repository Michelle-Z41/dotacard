game.states.table={build:function(){this.time=$("<p>").appendTo(game.topbar).addClass("time").text(game.data.ui.time+": 0:00 Day").hide(),this.turns=$("<p>").appendTo(game.topbar).addClass("turns").text(game.data.ui.turns+": 0/0 (0)").hide(),game.map.start(),this.selectedArea=$("<div>").appendTo(this.el).addClass("selectedarea").append($("<div>").addClass("cardback")),this.neutrals=$("<div>").appendTo(this.el).addClass("neutraldecks"),this.player=$("<div>").appendTo(this.el).addClass("playerdecks"),this.enemy=$("<div>").appendTo(this.el).addClass("enemydecks"),this.skip=$("<div>").appendTo(this.el).addClass("skip button").attr({disabled:!0}).onLeftClick(game.turn.skip).text(game.data.ui.skip),this.surrender=$("<div>").appendTo(this.el).addClass("surrender button").text(game.data.ui.surrender).onLeftClick(function(){confirm(game.data.ui.leave)&&game[game.mode].surrender()})},start:function(){game[game.mode].setTable(),game.chat.el.appendTo(this.el),this.time.show(),this.turns.show(),this.camera.show(),this.selectedArea.show()},buildUnits:function(){var a="A1";$("#"+a).addClass("jungle").attr({title:"Jungle"}),$("#"+game.map.mirrorPosition(a)).addClass("jungle").attr({title:"Jungle"}),game.neutrals={},game.neutrals.unitsDeck=game.deck.build({name:"units",filter:["forest"],cb:function(a){a.addClass("neutral units cemitery").hide().appendTo(game.states.table.neutrals),$.each(a.data("cards"),function(a,b){b.addClass("neutral unit").data("side","neutral").on("mousedown.select",game.card.select)})}}),game.player.unitsDeck=game.deck.build({name:"units",filter:game.player.picks,cb:function(a){a.addClass("player units cemitery").hide().appendTo(game.states.table.player),$.each(a.data("cards"),function(a,b){b.addClass("player unit").data("side","player").on("mousedown.select",game.card.select)})}}),game.enemy.unitsDeck=game.deck.build({name:"units",filter:game.enemy.picks,cb:function(a){a.addClass("enemy units cemitery").hide().appendTo(game.states.table.enemy),$.each(a.data("cards"),function(a,b){b.addClass("enemy unit").data("side","enemy").on("mousedown.select",game.card.select)})}})},animateCast:function(a,b){"string"==typeof b&&(b=$("#"+b));var c=a.offset(),d=b.offset();a.css({top:d.top-c.top+30,left:d.left-c.left+20,transform:"translate(-50%, -50%) scale(0.3)"}),setTimeout(function(){$(this.skill).css({top:"",left:"",transform:""})}.bind({skill:a}),500)},showResults:function(){game.states.table.selectedArea.hide(),game.states.table.camera.hide(),$(".table > .button").hide(),$(".table .deck").hide(),game.states.table.resultsbox=$("<div>").appendTo(game.states.table.el).addClass("resultsbox box"),$("<h1>").appendTo(this.resultsbox).addClass("result").text(game.winner+" "+game.data.ui.victory),$("<h1>").appendTo(this.resultsbox).text(game.data.ui.towers+" HP: "+game.player.tower.data("current hp")+" / "+game.enemy.tower.data("current hp")),$("<h1>").appendTo(this.resultsbox).text(game.data.ui.heroes+" "+game.data.ui.kd+": "+game.player.kills+" / "+game.enemy.kills),game.states.table.playerResults=$("<div>").appendTo(game.states.table.resultsbox).addClass("results"),game.states.table.enemyResults=$("<div>").appendTo(game.states.table.resultsbox).addClass("results"),$(".player.heroes.card").not(".zoom").each(function(){var a=$(this),b=$(this).data("hero"),c=$("<div>").addClass("portrait").append($("<div>").addClass("img")),d=$("<span>").text(a.data("name")+": "+a.data("kills")+" / "+a.data("deaths"));$("<p>").appendTo(game.states.table.playerResults).addClass(b+" heroes").append(c,d)}),$(".enemy.heroes.card").not(".zoom").each(function(){var a=$(this),b=$(this).data("hero"),c=$("<div>").addClass("portrait").append($("<div>").addClass("img")),d=$("<span>").text(a.data("name")+": "+a.data("kills")+" / "+a.data("deaths"));$("<p>").appendTo(game.states.table.enemyResults).addClass(b+" heroes").append(c,d)}),$("<div>").addClass("button close").appendTo(game.states.table.resultsbox).text(game.data.ui.close).onLeftClick(game.states.table.clear)},clear:function(){game[game.mode].clear(),game.map.clear(),$(".table .card").remove(),$(".table .deck").remove(),$(".table .resultsbox").remove(),game.clearTimeouts(),game.mode="",game.states.changeTo("menu")},end:function(){this.time.hide(),this.turns.hide()}};