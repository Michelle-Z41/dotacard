game.tutorial={build:function(){game.mode="tutorial",game.seed=(new Date).valueOf(),game.id=btoa(game.seed),game.message.text(game.data.ui.waiting),game.states.choose.counter.show().text(game.data.ui.rightpick),game.enemy.name="axe",game.enemy.type="challenged",game.player.type="challenger",game.states.choose.enablePick(),game.tutorial.axe||(game.tutorial.axe=$("<div>").addClass("axe tutorial"),game.tutorial.axeimg=$("<div>").addClass("img").appendTo(game.tutorial.axe),game.tutorial.axebaloon=$("<div>").addClass("baloon").appendTo(game.tutorial.axe),game.tutorial.message=$("<div>").addClass("txt").appendTo(game.tutorial.axebaloon)),game.tutorial.message.html(game.data.ui.axepick),game.tutorial.axe.appendTo(game.states.choose.el),game.tutorial.axeshow()},axeshow:function(){setTimeout(function(){game.tutorial.axe.addClass("up")},2e3),setTimeout(function(){game.audio.play("tutorial/axehere"),game.tutorial.axebaloon.fadeIn("slow"),game.message.text(game.data.ui.tutorialstart),game.loader.removeClass("loading")},2400)},pick:function(){game.tutorial.oldAvailableSlots=5;var a=$(".slot.available").length;4===a?game.tutorial.message.html(game.data.ui.axeheroes):3===a?game.tutorial.message.html(game.data.ui.axemaxcards):2===a?game.tutorial.message.html(game.data.ui.axecardsperturn):1===a&&game.tutorial.message.html(game.data.ui.axeautodeck),a<game.tutorial.oldAvailableSlots&&game.tutorial.axebaloon.hide().fadeIn("slow"),a?game.states.choose.counter.text(a+" "+game.data.ui.togo+". "+game.data.ui.cardsperturn+": "+game.player.cardsPerTurn):(game.message.text(game.data.ui.getready),game.states.choose.counter.text(game.data.ui.cardsperturn+": "+game.player.cardsPerTurn),game.tutorial.axe.addClass("left"),game.audio.play("tutorial/axebattle"),game.tutorial.message.html(game.data.ui.axebattle),setTimeout(function(){game.tutorial.heroesdeck()},2e3)),game.tutorial.oldAvailableSlots=a},heroesdeck:function(){game.player.picks=[],$(".slot").each(function(){var a=$(this),b=a.find(".card");game.player.picks[a.data("slot")]=b.data("hero"),5===game.player.picks.length&&(game.states.choose.reset(),game.states.changeTo("table"))})},start:function(){game.status="learning",game.message.text(game.data.ui.battle),game.loader.removeClass("loading"),game.audio.play("horn"),game.tower.place(),game.tree.place(),game.tutorial.placePlayerHeroes(),game.tutorial.placeEnemyHeroes(),game.states.table.buildUnits(),game.tutorial.started=!0,game.tutorial.axe.removeClass("up").appendTo(game.states.table.el),game.tutorial.axebaloon.hide(),game.tutorial.lessonSelectEnemy=!0,game.states.table.time.text(game.data.ui.time+": 0:00 "+game.data.ui.day),setTimeout(function(){game.tutorial.axe.addClass("up")},500),setTimeout(game.tutorial.selectEnemy,1e3),game.player.kills=0,game.enemy.kills=0},placePlayerHeroes:function(){game.player.mana=0,game.player.heroesDeck=game.deck.build({name:"heroes",filter:game.player.picks,cb:function(a){a.addClass("player").appendTo(game.states.table.player);var b=0,c=6;$.each(a.data("cards"),function(a,d){var e=game.player.picks.indexOf(d.data("hero"));d.addClass("player hero").data("side","player").on("click.select",game.tutorial.select),d.place(game.map.toId(b+e,c)),game.player.mana+=d.data("mana")})}})},placeEnemyHeroes:function(){game.enemy.picks=["nyx","kotl","pud","ld","am"],game.enemy.heroesDeck=game.deck.build({name:"heroes",filter:game.enemy.picks,cb:function(a){a.addClass("enemy").hide().appendTo(game.states.table.enemy);var b=0,c=6;$.each(a.data("cards"),function(a,d){var e=game.enemy.picks.indexOf(d.data("hero"));d.addClass("enemy hero").data("side","enemy").on("click.select",game.tutorial.select),d.place(game.map.mirrorPosition(game.map.toId(b+e,c)))})}})},selectEnemy:function(){game.tutorial.axebaloon.fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeselectenemy),game.message.text(game.data.ui.yourturncount+" 5"),$(".map .enemy.tower").addClass("tutorialblink").on("click.tutorialselect",game.card.select)},select:function(){var a=$(this).removeClass("tutorialblink");game.tutorial.lessonSelectEnemy&&a.hasAllClasses("tower enemy")&&($(".map .enemy.tower").removeClass("tutorialblink"),game.tutorial.lessonSelectEnemy=!1,game.tutorial.zoom()),game.tutorial.lessonSelectPlayer&&a.hasAllClasses("hero player")&&($(".map .player.hero").removeClass("tutorialblink"),game.tutorial.lessonSelectPlayer=!1,game.tutorial.move()),game.tutorial.lessonSkill&&a.hasAllClasses("skill player")&&($(".player.skill").removeClass("tutorialblink"),game.tutorial.lessonSkill=!1,game.tutorial.skill())},zoom:function(){game.tutorial.lessonZoom=!0,game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axezoom),game.message.text(game.data.ui.yourturncount+" 4"),game.states.table.selectedArea.addClass("tutorialblink"),game.states.table.selectedArea.on("mouseover.tutorial",".card",game.tutorial.over),$(".map .enemy.tower").off("click.tutorialselect"),$(".map .card").on("click.select",game.card.select)},over:function(){if(game.tutorial.lessonZoom){$(this);game.states.table.selectedArea.removeClass("tutorialblink"),game.tutorial.unselect(),game.tutorial.lessonZoom=!1}},unselect:function(){game.states.table.el.click(function(a){var b=$(a.target);b.closest(".selected").length||b.closest(".selectedarea").length||game.card.unselect()}),game.tutorial.lessonUnselect=!0,game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeunselect),game.message.text(game.data.ui.yourturncount+" 3"),game.states.table.selectedArea.on("unselect.tutorial",game.tutorial.unselected)},unselected:function(){game.tutorial.lessonUnselect&&(game.tutorial.selectPlayer(),game.tutorial.lessonUnselect=!1)},selectPlayer:function(){game.tutorial.lessonSelectPlayer=!0,$(".map .player.hero").addClass("tutorialblink"),game.tutorial.axe.removeClass("left"),game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeselectplayer),game.message.text(game.data.ui.yourturncount+" 2"),setTimeout(game.card.unselect),game.status="turn"},move:function(){game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axemove),game.audio.play("tutorial/axemove"),game.message.text(game.data.ui.yourturncount+" 1"),$(".map .hero.player").on("move",game.tutorial.done)},done:function(){game.turn.el||(game.turn.el=$("<h1>").addClass("turntitle").appendTo(game.states.table.el)),setTimeout(function(){game.turn.el.text(game.data.ui.enemyturn),game.turn.el.addClass("show")},1e3),setTimeout(function(){game.turn.el.removeClass("show"),game.tutorial.axe.addClass("left"),game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axedone),game.message.text(game.data.ui.enemyturn),game.message.addClass("tutorialblink"),game.status="unturn",setTimeout(game.tutorial.wait,5e3)},4e3)},wait:function(){game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axewait),game.message.text(game.data.ui.enemyturncount+" 2"),game.audio.play("tutorial/axetime"),game.states.table.time.text(game.data.ui.time+": 1:30 "+game.data.ui.night),game.message.removeClass("tutorialblink"),game.states.table.time.addClass("tutorialblink"),setTimeout(game.tutorial.time,5e3)},time:function(){game.tutorial.axebaloon.hide().fadeIn("slow"),game.message.text(game.data.ui.enemyturncount+" 1"),game.tutorial.message.html(game.data.ui.axetime),game.states.table.time.removeClass("tutorialblink"),game.states.table.turns.addClass("tutorialblink"),game.states.table.turns.text(game.data.ui.turns+": 1/1 (2)"),setTimeout(game.tutorial.enemyMove,5e3),game.tutorial.buildSkills()},enemyMove:function(){game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeenemymove),game.message.html(game.data.ui.enemymove),game.audio.play("tutorial/axewait"),game.states.table.turns.removeClass("tutorialblink");var a="E7",b="G2";$("#"+game.map.mirrorPosition(b)).hasClass("block")&&(b="G1"),game.currentData={moves:"C:"+a+":"+b+":blink:am"},game.enemy.move(),setTimeout(function(){game.turn.el.text(game.data.ui.yourturn),game.turn.el.addClass("show")},2e3),setTimeout(game.tutorial.attack,5e3)},attack:function(){game.turn.el.removeClass("show"),game.tutorial.axe.removeClass("left"),game.enemy.skills.deck.removeClass("slide"),$(".enemy.skills .card").fadeOut(400),game.tutorial.lessonAttack=!0,$(".map .hero").removeClass("done");var a=game.map.getPosition($(".map .enemy.am")),b=game.map.getRange(game.data.ui.ranged);game.map.around(a,b,function(a){a.find(".card.player.hero").addClass("tutorialblink")}),game.status="turn",game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeattack),game.audio.play("tutorial/axeattack"),game.message.html(game.data.ui.yourturn),game.selectedCard&&game.selectedCard.select(),$(".player.hero").on("attack.tutorial",game.tutorial.skillSelect)},buildSkills:function(){game.player.skills={},game.player.skills.hand=$("<div>").hide().appendTo(game.states.table.player).addClass("player deck skills hand"),game.player.skills.sidehand=$("<div>").hide().appendTo(game.states.table.player).addClass("player deck skills sidehand"),game.player.skills.temp=$("<div>").hide().appendTo(game.states.table.player).addClass("player deck skills temp"),game.player.skills.ult=$("<div>").hide().appendTo(game.states.table.player).addClass("player deck skills ult"),game.player.skills.cemitery=$("<div>").hide().appendTo(game.states.table.player).addClass("player deck skills cemitery"),game.player.skills.deck=game.deck.build({name:"skills",filter:[game.player.picks[3],game.player.picks[4]],cb:function(a){a.addClass("player available").hide().appendTo(game.states.table.player),$.each(a.data("cards"),function(a,b){b.addClass("player skill").data("side","player").on("click.tutorial",game.tutorial.select).on("click.select",game.card.select)})}}),game.enemy.skills={},game.enemy.skills.deck=game.deck.build({name:"skills",filter:["am"],cb:function(a){a.addClass("enemy hand cemitery toggle").appendTo(game.states.table.enemy),$.each(a.data("cards"),function(a,b){b.hide().addClass("enemy skill").data("side","enemy")})}})},skillSelect:function(){$(".card.enemy.done").removeClass("done"),game.tutorial.lessonSkill=!0,game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeskillselect),game.player.buyHand(),game.player.skills.hand.show(),game.player.skills.sidehand.show(),$(".player.hero").removeClass("tutorialblink"),$(".player.skill").addClass("tutorialblink"),setTimeout(function(){$(".player.hero").removeClass("done")},200)},skill:function(){game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeskill),$(".card").on("cast.tutorial",game.tutorial.end),$(".card").on("passive.tutorial",game.tutorial.end),$(".card").on("toggle.tutorial",game.tutorial.end)},end:function(){game.tutorial.lessonAttack=!1,game.tutorial.lessonSkill=!1,game.tutorial.axebaloon.hide().fadeIn("slow"),game.tutorial.message.html(game.data.ui.axeend),game.audio.play("tutorial/axeah"),game.message.text(game.data.ui.lose),game.winner=game.player.name,game.states.table.showResults(),game.tutorial.started=!1,game.status="tutorialcompleted"},clear:function(){game.tutorial.axe.removeClass("up"),game.tutorial.axe.removeClass("left"),game.tutorial.axebaloon.hide(),game.db({set:"chat",data:game.player.name+" "+game.data.ui.completedtutorial},function(a){game.chat.update(a)})}};