game.turn={build:function(){game.time=0,game.player.turn=0,game.enemy.turn=0,game.player.kills=0,game.enemy.kills=0,game.currentData.moves=[],game.currentData={},game.turn.el=$("<h1>").addClass("turntitle").appendTo(game.states.table.el),"challenged"===game.player.type&&(game.status="turn"),"challenger"===game.player.type&&(game.status="unturn")},reset:function(){game.currentData.moves=[],$(".card .damaged").remove(),$(".card .heal").remove()},begin:function(){"over"!==game.status&&(game.turn.reset(),$(".card.dead").each(function(){var a=$(this);game.time>a.data("reborn")&&a.reborn()}),6===game.turn&&$(".card",game.states.table.playerUlts).appendTo(game.player.skills.deck),game.time=game.player.turn+game.enemy.turn,game.turn.counter=game.timeToPlay,"turn"===game.status?game.turn.el.text(game.data.ui.yourturn):"unturn"===game.status&&(game.turn.el.text(game.data.ui.enemyturn),game.turn.counter+=1),game.loader.removeClass("loading"),game.turn.el.addClass("show"),setTimeout(game.turn.start,3e3))},start:function(){"turn"===game.status?(game.states.table.skip.attr({disabled:!1}),game.states.table.el.removeClass("unturn").addClass("turn"),game.message.text(game.data.ui.yourturn),game.player.turn+=1,$(".map .card.player").removeClass("done"),game.tower.attack(),game.map.highlight(),game.player.buyHand()):(game.message.text(game.data.ui.enemyturn),game.enemy.turn+=1,$(".map .card.enemy").removeClass("done"),game.enemy.buyHand()),$(".card").each(function(){var a=$(this);a.trigger("turnstart",{target:a}),"turn"===game.status?a.trigger("playerturnstart",{target:a}):a.trigger("enemyturnstart",{target:a}),a.reduceStun()}),game.turn.el.removeClass("show"),setTimeout(game.turn.count,1e3)},count:function(){clearTimeout(game.timeout),game.states.table.time.text(game.data.ui.time+": "+game.turn.hours()+" "+game.turn.dayNight()),game.states.table.turns.text(game.data.ui.turns+": "+game.player.turn+"/"+game.enemy.turn+" ("+parseInt(game.time,10)+")"),"turn"===game.status?game.message.text(game.data.ui.yourturncount+" "+game.turn.counter+" "+game.data.ui.seconds):"unturn"===game.status&&game.message.text(game.data.ui.enemyturncount+" "+game.turn.counter+" "+game.data.ui.seconds),game.turn.counter<1?game.turn.end():game.timeout=setTimeout(game.turn.count,1e3),game.time+=.9/game.timeToPlay,game.turn.counter-=1},skip:function(a){console.log(a,this),this.attr("disabled")||(game.turn.counter=0,console.log("skip"))},end:function(){game.message.text(game.data.ui.turnend),game.map.unhighlight(),$(".card .damaged").remove(),$(".card .heal").remove(),$(".spot.fountain").find(".card").each(function(){var a=$(this),b=.1*a.data("hp");a.heal(b)}),$(".card.heroes").each(function(){var a=$(this);a.data("channeling")&&a.trigger("channel",{source:a}),a.trigger("turnend",{target:a})}),"turn"===game.status?(game.states.table.skip.attr({disabled:!0}),game.states.table.el.removeClass("turn"),game.states.table.el.addClass("unturn"),game.status="unturn",setTimeout(game.match.sendData,1e3)):(game.tries=1,setTimeout(game.match.getData,1e3))},hours:function(){var a,b,c,d=game.time%game.dayLength,e=d/game.dayLength,f=24*e,g=parseInt(f,10),h=f-g;return 0>h&&(h=0),a=60*h,b=parseInt(a,10),c=10>b?"0"+b:b,g+":"+c},dayNight:function(){var a=game.time%game.dayLength;return a<game.dayLength/2?game.data.ui.day:game.data.ui.night}};