game.chat={build:function(){game.chat.el=$("<div>").addClass("chat").appendTo(game.states.menu.el).html("<h1>Chat</h1>").hover(function(){game.chat.input.focus()}),game.chat.messages=$("<div>").addClass("messages").appendTo(game.chat.el),game.chat.input=$("<input>").appendTo(game.chat.el).attr({type:"text",maxlength:42}).keydown(function(a){13===a.which&&game.chat.send()}),game.chat.button=$("<div>").addClass("button").appendTo(game.chat.el).onLeftClick(game.chat.send).text("Send"),game.chat.icon=$("<span>").text("Chat").addClass("chat-icon").appendTo(game.chat.el),setInterval(function(){game.db({get:"chat"},function(a){game.chat.update(a)})},5e3),game.db({set:"chat",data:game.player.name+" "+game.data.ui.joined},function(a){game.chat.update(a)}),game.chat.el.appendTo(game.states.menu.el),game.chat.builded=!0},update:function(a){var b=!1,c=game.chat.messages[0].scrollHeight-game.chat.messages.height(),d=game.chat.messages.scrollTop();(d>.9*c||80>c)&&(b=!0),game.chat.messages.empty(),$.each(a.messages,function(){$("<p>").text(this).prependTo(game.chat.messages)}),b&&game.chat.messages.scrollTop(game.chat.messages[0].scrollHeight)},send:function(){var a=game.chat.input.val();a?(game.chat.button.attr("disabled",!0),game.loader.addClass("loading"),game.chat.input.val(""),game.db({set:"chat",data:game.player.name+": "+a},function(a){game.chat.update(a),setTimeout(function(){game.loader.removeClass("loading"),game.chat.button.attr("disabled",!1)},2e3)})):game.chat.input.focus()}};