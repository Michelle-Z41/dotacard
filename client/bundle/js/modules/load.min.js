game.load={updating:0,totalUpdate:7,start:function(){game.status="loading",$(".loadtext .message").text("Updating: "),$(".loadtext .progress").text("0%"),game.load.images.preload(),game.load.pack(),window.AudioContext&&(game.audio.build(),game.load.track(),game.load.sounds()),game.load.language(function(){game.load.data()}),game.load.ping(function(){game.offline||"localhost"===location.host||game.load.analytics()}),setTimeout(game.load.progress)},progress:function(){clearTimeout(game.timeout);var a=Number.parseInt(game.load.updating/game.load.totalUpdate*100);$(".progress").text(a+"%"),game.load.updating<game.load.totalUpdate?(game.status="loading",game.timeout=setTimeout(game.load.progress,10)):game.version&&game.load.updating===game.load.totalUpdate&&(game.states.build(),setTimeout(function(){game.states.changeTo("log")},1e3))},images:{array:["tutorial/axe.png","bkg/polygon-dark.jpg","heroes/crystal_maiden_full.jpg","heroes/keeper_of_the_light_full.jpg","heroes/skeleton_king_full.jpg","heroes/lone_druid_full.jpg","heroes/antimage_full.jpg","heroes/nyx_assassin_full.jpg","heroes/pudge_full.jpg","fx/hook.png","bkg/map_vectorized.jpg","cardback.jpg"],preload:function(){var a=$("<div>").addClass("preload hidden").appendTo(document.body);$(game.load.images.array).each(function(){$("<img/>").attr("src","img/"+this).appendTo(a)})}},json:function(a,b){$.ajax({async:!0,type:"GET",url:"json/"+game.language.dir+a+".json",complete:function(c){game.load.updating+=1;var d=JSON.parse(c.responseText);game.data[a]=d,b&&b(d)}})},language:function(a){game.db({get:"lang"},function(b){game.load.updating+=1,b.lang&&(game.language.detected=b.lang.split(";")[0].split(",")[0],game.language.available.indexOf(game.language.detected)>0&&(game.language.current=game.language.detected,game.language.dir=game.language.current+"/")),a&&a()})},pack:function(){$.ajax({async:!0,type:"GET",url:"package.json",complete:function(a){game.load.updating+=1;var b=JSON.parse(a.responseText);$.each(b,function(a){game[a]=this})}})},data:function(){game.load.json("ui"),game.load.json("heroes"),game.load.json("units"),game.load.json("skills",function(){var a,b;for(a in game.data.skills)if(game.data.skills.hasOwnProperty(a))for(b in game.data.skills[a])game.data.skills[a].hasOwnProperty(b)&&(game.data.skills[a][b].buff=a+"-"+b,game.data.skills[a][b].hero=a,game.data.skills[a][b].skill=b)}),game.load.json("buffs",function(){var a,b;for(a in game.data.buffs)if(game.data.buffs.hasOwnProperty(a))for(b in game.data.buffs[a])game.data.buffs[a].hasOwnProperty(b)&&(game.data.buffs[a][b].buff=a+"-"+b,game.data.buffs[a][b].hero=a,game.data.buffs[a][b].skill=b)})},audio:function(a,b){var c=new XMLHttpRequest;c.open("GET","/audio/"+a+".mp3",!0),c.responseType="arraybuffer",c.onload=function(){game.audio.context.decodeAudioData(c.response,function(c){game.audio.buffers[a]=c,b&&b()})},c.send()},sounds:function(){$(game.audio.sounds).each(function(a,b){game.load.audio(b)})},track:function(){game.song="doomhammer",game.load.audio(game.song,function(){game.audio.play(game.song),setInterval(function(){game.audio.play(game.song)},1e3*game.audio.buffers[game.song].duration)})},ping:function(a){var b=new Date;$.ajax({async:!0,type:"GET",url:game.homepage,complete:function(c){game.ping=new Date-b,4===c.readyState?game.offline=!1:game.offline=!0,a&&a()}})},analytics:function(){$('<script src="analytics/google.analytics.min.js">').appendTo("body")},reset:function(){console.log("Internal error: ",game);var a=confirm(game.data.ui.error);a&&location.reload(!0)}};